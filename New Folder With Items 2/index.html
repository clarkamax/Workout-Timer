<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Workout Timer</title>


<style>
  body{
    margin:0;
    height:100vh;
    display:flex;
    flex-direction:column;
    background:#000000;
    font-family:Arial, Helvetica, sans-serif;
    padding-bottom:170px; /* space for fixed controls */
  }

  #build{
    position:fixed;
    top:12px;
    left:14px;
    color:#444;
    font-weight:800;
    font-size:14px;
    z-index:20;
    letter-spacing:1px;
  }

  #clock{
    position:fixed;
    top:14px;
    right:18px;
    color:#bbb;
    font-weight:800;
    font-size:28px;
    letter-spacing:1px;
    z-index:20;
  }

  .center{
    flex:1;
    display:grid;
    grid-template-rows:auto auto auto auto;
    align-content:center;
    justify-items:center;
    gap:10px;
    padding:18px;
  }

  #phase{
    display:flex;
    align-items:center;
    justify-content:center;
  }
  #phase img{
    width:min(85vw, 900px);
    height:auto;
    display:block;
  }

  #time{
    font-weight:900;
    font-size:22vw;
    color:#00ff5a;
    font-variant-numeric: tabular-nums;
    line-height:1;
  }
  #set{
    font-weight:900;
    font-size:64px;
    color:#fff;
  }
  #workElapsed{
    margin-top:6px;
    color:#bbb;
    font-weight:800;
    font-size:22px;
    letter-spacing:0.5px;
  }

  .controls{
    position:fixed;
    left:0;
    right:0;
    bottom:0;
    border-top:1px solid #222;
    padding:14px;
    background:#050505;
    display:flex;
    flex-direction:column;
    gap:12px;
    align-items:center;
    z-index:20;
  }

  .controls .row{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    justify-content:center;
    align-items:center;
  }

  label{ color:#bbb; font-size:12px; }

  select{
    width:130px;
    padding:10px;
    border-radius:8px;
    border:1px solid #333;
    background:#111;
    color:#fff;
    font-size:16px;
    appearance:auto;
  }

  button{
    padding:12px 16px;
    border-radius:8px;
    border:1px solid #333;
    background:#222;
    color:#fff;
    font-weight:900;
  }
  button.primary{ background:#1d4ed8; border-color:#1d4ed8; }
  button:disabled{ opacity:.4; }
</style>


</head>


<body>
  <div id="build">BUILD 1</div>
  <div id="clock">--:--</div>


  <div class="center">
    <div id="phase">
      <img alt="logo" src="logo.png" />
    </div>
    <div id="time">01:00</div>
    <div id="set">SET 1 / 5</div>
    <div id="workElapsed">WORK TIME: 00:00:00</div>
  </div>


  <div class="controls">
    <div class="row">
      <label>Minutes</label><select id="minutes"></select>
      <label>Seconds</label><select id="seconds"></select>
      <label>Sets</label><select id="sets"></select>
    </div>


<div class="row">
  <button class="primary" id="start">START</button>
  <button id="stop" disabled>STOP</button>
  <button id="reset">RESET</button>
</div>

  </div>


<script>
// IMPORTANT:
// If this page is opening as plain text in TextEdit, you saved it as RTF.
// In TextEdit: Format -> Make Plain Text, then Save as index.html

// Clock
function updateClock(){
  const now = new Date();
  document.getElementById('clock').textContent = now.toLocaleTimeString([], { hour:'numeric', minute:'2-digit' });
}
updateClock();
setInterval(updateClock, 1000);


// Horn
// Local file: horn.wav
// GitHub: bump v= to force refresh after changing the horn file
const hornBase = 'horn.wav';
const hornUrl = (location.protocol === 'file:') ? hornBase : (hornBase + '?v=1');
function playHorn(times){
  const n = Math.max(1, times || 1);
  let i = 0;
  const playOnce = () => {
    const a = new Audio(hornUrl);
    a.volume = 1.0;
    a.play().then(() => {
      a.addEventListener('ended', () => {
        i += 1;
        if(i < n) playOnce();
      }, { once:true });
    }).catch(() => {});
  };
  playOnce();
}

// Dropdowns
const minSel = document.getElementById('minutes');
const secSel = document.getElementById('seconds');
const setsSel = document.getElementById('sets');

function fill(sel, values, pad2){
  sel.innerHTML = '';
  values.forEach(v => {
    const o = document.createElement('option');
    o.value = String(v);
    o.textContent = pad2 ? String(v).padStart(2,'0') : String(v);
    sel.appendChild(o);
  });
}

fill(minSel, Array.from({length:61}, (_,i)=>i), false);
fill(secSel, [0,5,10,15,20,25,30,35,40,45,50,55], true);
fill(setsSel, Array.from({length:99}, (_,i)=>i+1), false);

minSel.value = '1';
secSel.value = '0';
setsSel.value = '5';

// Timer state
const timeEl = document.getElementById('time');
const setEl = document.getElementById('set');
const workEl = document.getElementById('workElapsed');

const startBtn = document.getElementById('start');
const stopBtn = document.getElementById('stop');
const resetBtn = document.getElementById('reset');

let total = 60;
let remain = 60;
let sets = 5;
let current = 1;
let running = false;
let intervalId = null;
let workSeconds = 0;

function readInputs(){
  const mins = parseInt(minSel.value, 10) || 0;
  const secs = parseInt(secSel.value, 10) || 0;
  total = Math.max(1, mins*60 + secs);
  sets = Math.max(1, parseInt(setsSel.value, 10) || 1);
  if(current > sets) current = sets;
}

function fmtMMSS(s){
  const m = Math.floor(s/60);
  const r = s%60;
  return String(m).padStart(2,'0') + ':' + String(r).padStart(2,'0');
}
function fmtHMS(s){
  const h = Math.floor(s/3600);
  const m = Math.floor((s%3600)/60);
  const r = s%60;
  return String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0') + ':' + String(r).padStart(2,'0');
}

function applyTimeColor(){
  if(remain <= 3) timeEl.style.color = '#ff2a2a';
  else if(remain <= 10) timeEl.style.color = '#ffb020';
  else timeEl.style.color = '#00ff5a';
}

function render(){
  timeEl.textContent = fmtMMSS(remain);
  setEl.textContent = `SET ${current} / ${sets}`;
  workEl.textContent = `WORK TIME: ${fmtHMS(workSeconds)}`;
  applyTimeColor();
  startBtn.disabled = running;
  stopBtn.disabled = !running;
}

function start(){
  if(running) return;
  readInputs();
  if(remain <= 0) remain = total;
  running = true;
  playHorn(1);

  intervalId = setInterval(() => {
    remain -= 1;
    workSeconds += 1;

    if(remain <= 0){
      remain = 0;
      render();

      if(current >= sets){
        playHorn(2);
        clearInterval(intervalId);
        intervalId = null;
        running = false;
        render();
        return;
      }

      playHorn(1);
      current += 1;
      remain = total;
    }

    render();
  }, 1000);

  render();
}

function stop(){
  running = false;
  if(intervalId) clearInterval(intervalId);
  intervalId = null;
  render();
}

function resetAll(){
  stop();
  readInputs();
  current = 1;
  remain = total;
  workSeconds = 0;
  render();
}

startBtn.addEventListener('click', start);
stopBtn.addEventListener('click', stop);
resetBtn.addEventListener('click', resetAll);

[minSel, secSel, setsSel].forEach(el => {
  el.addEventListener('change', () => {
    if(!running){
      readInputs();
      remain = total;
      current = Math.min(current, sets);
      render();
    }
  });
});

window.addEventListener('keydown', (e) => {
  if(e.code === 'Space'){
    e.preventDefault();
    running ? stop() : start();
  }
});

readInputs();
remain = total;
render();
</script>


</body>
</html>
